package com.facebook.soloader;

import android.os.StrictMode;
import android.util.Log;
import java.io.File;
import java.io.IOException;
import java.util.Arrays;

public class c extends k {
  protected final File a;
  
  protected final int b;
  
  public c(File paramFile, int paramInt) {
    this.a = paramFile;
    this.b = paramInt;
  }
  
  private void a(File paramFile, int paramInt, StrictMode.ThreadPolicy paramThreadPolicy) {
    String[] arrayOfString = a(paramFile);
    StringBuilder stringBuilder = new StringBuilder();
    stringBuilder.append("Loading lib dependencies: ");
    stringBuilder.append(Arrays.toString(arrayOfString));
    Log.d("SoLoader", stringBuilder.toString());
    byte b1;
    for (b1 = 0; b1 < arrayOfString.length; b1++) {
      String str = arrayOfString[b1];
      if (!str.startsWith("/"))
        SoLoader.a(str, paramInt | true, paramThreadPolicy); 
    } 
  }
  
  private static String[] a(File paramFile) {
    if (SoLoader.a) {
      StringBuilder stringBuilder = new StringBuilder();
      stringBuilder.append("SoLoader.getElfDependencies[");
      stringBuilder.append(paramFile.getName());
      stringBuilder.append("]");
      Api18TraceUtils.a(stringBuilder.toString());
    } 
    try {
      return i.a(paramFile);
    } finally {
      if (SoLoader.a)
        Api18TraceUtils.a(); 
    } 
  }
  
  public int a(String paramString, int paramInt, StrictMode.ThreadPolicy paramThreadPolicy) { return a(paramString, paramInt, this.a, paramThreadPolicy); }
  
  protected int a(String paramString, int paramInt, File paramFile, StrictMode.ThreadPolicy paramThreadPolicy) {
    StringBuilder stringBuilder1;
    File file = new File(paramFile, paramString);
    if (!file.exists()) {
      stringBuilder1 = new StringBuilder();
      stringBuilder1.append(paramString);
      stringBuilder1.append(" not found on ");
      stringBuilder1.append(paramFile.getCanonicalPath());
      Log.d("SoLoader", stringBuilder1.toString());
      return 0;
    } 
    StringBuilder stringBuilder2 = new StringBuilder();
    stringBuilder2.append(paramString);
    stringBuilder2.append(" found on ");
    stringBuilder2.append(paramFile.getCanonicalPath());
    Log.d("SoLoader", stringBuilder2.toString());
    if ((paramInt & true) != 0 && (this.b & 0x2) != 0) {
      StringBuilder stringBuilder = new StringBuilder();
      stringBuilder.append(paramString);
      stringBuilder.append(" loaded implicitly");
      Log.d("SoLoader", stringBuilder.toString());
      return 2;
    } 
    if ((this.b & true) != 0) {
      a(file, paramInt, stringBuilder1);
    } else {
      StringBuilder stringBuilder = new StringBuilder();
      stringBuilder.append("Not resolving dependencies for ");
      stringBuilder.append(paramString);
      Log.d("SoLoader", stringBuilder.toString());
    } 
    try {
      SoLoader.b.a(file.getAbsolutePath(), paramInt);
      return 1;
    } catch (UnsatisfiedLinkError paramString) {
      if (paramString.getMessage().contains("bad ELF magic")) {
        Log.d("SoLoader", "Corrupted lib file detected");
        return 3;
      } 
      throw paramString;
    } 
  }
  
  public File a(String paramString) {
    File file = new File(this.a, paramString);
    return file.exists() ? file : null;
  }
  
  public String toString() {
    String str;
    try {
      str = String.valueOf(this.a.getCanonicalPath());
    } catch (IOException iOException) {
      str = this.a.getName();
    } 
    StringBuilder stringBuilder = new StringBuilder();
    stringBuilder.append(getClass().getName());
    stringBuilder.append("[root = ");
    stringBuilder.append(str);
    stringBuilder.append(" flags = ");
    stringBuilder.append(this.b);
    stringBuilder.append(']');
    return stringBuilder.toString();
  }
}
