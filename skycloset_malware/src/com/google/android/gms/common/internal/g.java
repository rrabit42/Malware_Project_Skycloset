package com.google.android.gms.common.internal;

import android.content.ComponentName;
import android.content.Context;
import android.content.ServiceConnection;
import android.os.Handler;
import android.os.Message;
import android.util.Log;
import com.google.android.gms.common.a.a;
import java.util.HashMap;

final class g extends e implements Handler.Callback {
  private final HashMap<f, h> a = new HashMap();
  
  private final Context b;
  
  private final Handler c;
  
  private final a d;
  
  private final long e;
  
  private final long f;
  
  g(Context paramContext) {
    this.b = paramContext.getApplicationContext();
    this.c = new Handler(paramContext.getMainLooper(), this);
    this.d = a.a();
    this.e = 5000L;
    this.f = 300000L;
  }
  
  protected final boolean a(f paramf, ServiceConnection paramServiceConnection, String paramString) {
    af.a(paramServiceConnection, "ServiceConnection must not be null");
    synchronized (this.a) {
      h h1;
      h h2 = (h)this.a.get(paramf);
      if (h2 == null) {
        h2 = new h(this, paramf);
        h2.a(paramServiceConnection, paramString);
        h2.a(paramString);
        this.a.put(paramf, h2);
        h1 = h2;
      } else {
        this.c.removeMessages(0, h1);
        if (!h2.a(paramServiceConnection)) {
          h2.a(paramServiceConnection, paramString);
          switch (h2.b()) {
            case 2:
              h2.a(paramString);
              h1 = h2;
              return h1.a();
            case 1:
              paramServiceConnection.onServiceConnected(h2.e(), h2.d());
              h1 = h2;
              return h1.a();
          } 
        } else {
          String str;
          StringBuilder stringBuilder = new StringBuilder((str = String.valueOf(h1)).valueOf(str).length() + 81);
          stringBuilder.append("Trying to bind a GmsServiceConnection that was already connected before.  config=");
          stringBuilder.append(str);
          throw new IllegalStateException(stringBuilder.toString());
        } 
        h1 = h2;
      } 
      return h1.a();
    } 
  }
  
  protected final void b(f paramf, ServiceConnection paramServiceConnection, String paramString) {
    af.a(paramServiceConnection, "ServiceConnection must not be null");
    synchronized (this.a) {
      h h = (h)this.a.get(paramf);
      if (h != null) {
        Message message;
        if (h.a(paramServiceConnection)) {
          h.b(paramServiceConnection, paramString);
          if (h.c()) {
            message = this.c.obtainMessage(0, paramf);
            this.c.sendMessageDelayed(message, this.e);
          } 
          return;
        } 
        StringBuilder stringBuilder1 = new StringBuilder((str = String.valueOf(message)).valueOf(str).length() + 76);
        stringBuilder1.append("Trying to unbind a GmsServiceConnection  that was not bound before.  config=");
        stringBuilder1.append(str);
        throw new IllegalStateException(stringBuilder1.toString());
      } 
      String str;
      StringBuilder stringBuilder = new StringBuilder((str = String.valueOf(str)).valueOf(str).length() + 50);
      stringBuilder.append("Nonexistent connection status for service config: ");
      stringBuilder.append(str);
      throw new IllegalStateException(stringBuilder.toString());
    } 
  }
  
  public final boolean handleMessage(Message paramMessage) {
    switch (paramMessage.what) {
      default:
        return false;
      case 1:
        synchronized (this.a) {
          f f1 = (f)paramMessage.obj;
          h h = (h)this.a.get(f1);
          if (h != null && h.b() == 3) {
            String str;
            StringBuilder stringBuilder = new StringBuilder((str = String.valueOf(f1)).valueOf(str).length() + 47);
            stringBuilder.append("Timeout waiting for ServiceConnection callback ");
            stringBuilder.append(str);
            Log.wtf("GmsClientSupervisor", stringBuilder.toString(), new Exception());
            ComponentName componentName2 = h.e();
            ComponentName componentName1 = componentName2;
            if (componentName2 == null)
              componentName1 = f1.b(); 
            componentName2 = componentName1;
            if (componentName1 == null)
              componentName2 = new ComponentName(f1.a(), "unknown"); 
            h.onServiceDisconnected(componentName2);
          } 
          return true;
        } 
      case 0:
        break;
    } 
    synchronized (this.a) {
      f f1 = (f)paramMessage.obj;
      h h = (h)this.a.get(f1);
      if (h != null && h.c()) {
        if (h.a())
          h.b("GmsClientSupervisor"); 
        this.a.remove(f1);
      } 
      return true;
    } 
  }
}
