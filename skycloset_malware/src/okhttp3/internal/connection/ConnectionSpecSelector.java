package okhttp3.internal.connection;

import java.io.IOException;
import java.net.UnknownServiceException;
import java.util.Arrays;
import java.util.List;
import javax.net.ssl.SSLSocket;
import okhttp3.ConnectionSpec;
import okhttp3.internal.Internal;

public final class ConnectionSpecSelector {
  private final List<ConnectionSpec> connectionSpecs;
  
  private boolean isFallback;
  
  private boolean isFallbackPossible;
  
  private int nextModeIndex = 0;
  
  public ConnectionSpecSelector(List<ConnectionSpec> paramList) { this.connectionSpecs = paramList; }
  
  private boolean isFallbackPossible(SSLSocket paramSSLSocket) {
    for (int i = this.nextModeIndex; i < this.connectionSpecs.size(); i++) {
      if (((ConnectionSpec)this.connectionSpecs.get(i)).isCompatible(paramSSLSocket))
        return true; 
    } 
    return false;
  }
  
  public ConnectionSpec configureSecureSocket(SSLSocket paramSSLSocket) {
    ConnectionSpec connectionSpec;
    int i = this.nextModeIndex;
    int j = this.connectionSpecs.size();
    while (true) {
      if (i < j) {
        ConnectionSpec connectionSpec1 = (ConnectionSpec)this.connectionSpecs.get(i);
        if (connectionSpec1.isCompatible(paramSSLSocket)) {
          this.nextModeIndex = i + 1;
          break;
        } 
        i++;
        continue;
      } 
      connectionSpec = null;
      break;
    } 
    if (connectionSpec != null) {
      this.isFallbackPossible = isFallbackPossible(paramSSLSocket);
      Internal.instance.apply(connectionSpec, paramSSLSocket, this.isFallback);
      return connectionSpec;
    } 
    StringBuilder stringBuilder = new StringBuilder();
    stringBuilder.append("Unable to find acceptable protocols. isFallback=");
    stringBuilder.append(this.isFallback);
    stringBuilder.append(", modes=");
    stringBuilder.append(this.connectionSpecs);
    stringBuilder.append(", supported protocols=");
    stringBuilder.append(Arrays.toString(paramSSLSocket.getEnabledProtocols()));
    throw new UnknownServiceException(stringBuilder.toString());
  }
  
  public boolean connectionFailed(IOException paramIOException) {
    byte b = 1;
    this.isFallback = true;
    if (!this.isFallbackPossible)
      return false; 
    if (paramIOException instanceof java.net.ProtocolException)
      return false; 
    if (paramIOException instanceof java.io.InterruptedIOException)
      return false; 
    boolean bool = paramIOException instanceof javax.net.ssl.SSLHandshakeException;
    if (bool && paramIOException.getCause() instanceof java.security.cert.CertificateException)
      return false; 
    if (paramIOException instanceof javax.net.ssl.SSLPeerUnverifiedException)
      return false; 
    int i = b;
    if (!bool) {
      i = b;
      if (!(paramIOException instanceof javax.net.ssl.SSLProtocolException)) {
        if (paramIOException instanceof javax.net.ssl.SSLException)
          return true; 
        i = 0;
      } 
    } 
    return i;
  }
}
